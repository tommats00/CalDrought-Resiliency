---
title: "Gap Analysis"
author: "Tom Gibbens-Matsuyama"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

### Gap Analysis

### California Natural Resources Agency Website

## Five Year Shortage

#### Description 

This table provides anticipated annual potable water levels (both surplus and shortage) with shortage actions and without shortage actions for five years based on the five driest consecutive years on record. The Urban Water Management Plans (UWMP) reports this data. All data reported through the UWMP are currently available on the WUE portal and the California Natural Resources Open Data Portal. The most recent UWMP guidance is available here. See 7-20 through 7-34 for information about the data elements contained in the five_year_outlook table.

Data use limitations: Similar to the monthly_water_shortage_outlook data, these data also reflect forecasted values rather than actual values. These data are expected to change as conditions change.

### Load libraries

```{r}
library(tidyverse)
library(here)
```

### Load data
```{r}
five_year_shortage <- read_csv(here("data", "five_year_water_shortage_outlook.csv"))
```

### Problem 1

```{r}
# Replacing NAs with 0s, assuming this as true 
five_year_replace_na <- five_year_shortage %>% 
  
  # Mutate existing columns and replace NAs with 0s
  mutate(benefit_supply_augmentation_acre_feet = replace_na(benefit_supply_augmentation_acre_feet, 0),
         benefit_demand_reduction_acre_feet = replace_na(benefit_demand_reduction_acre_feet, 0)) 

# Creating a function that calculates supply + demand red + supply aug when Use > Supply
calculate_benefit <- function(df) {
  five_year_replace_na %>% 
    
    # Create new columns
    mutate(total_benefit = ifelse(
      
      # Use ifelse statement for when use > supply 
      water_use_acre_feet > water_supplies_acre_feet,
      
      # If true, then do the following, If false, assign a 0 
      water_supplies_acre_feet + benefit_demand_reduction_acre_feet + benefit_supply_augmentation_acre_feet, 0
    ))
}

# Use the function to reassign the df 
five_year_replace_na <- calculate_benefit(five_year_replace_na)

# Let's view the data where total_benefit does not equal total use
five_year_na_filtered <- five_year_replace_na %>% 
  filter(water_use_acre_feet != total_benefit)
```


